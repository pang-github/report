<%layout("/common/_container.html"){%><style>    .layui-input-inline{        width: 140px;    }    .layui-form-label{        width: 70px;    }</style><div id="app" class="layui-card-body bg-white" style="padding: 30px; ">    <form class="layui-form" method="post" action="/setConditionFields">        <input type="hidden" id="tableName" name="tableName" value="${parameter.tableName}">        <table class="layui-table" lay-skin="line">            <template v-for="(item,n) in items">                <tr>                    <td>                        <input type="checkbox" :value="item.columnName" lay-filter="search"  title="查询">                        <div class="layui-inline">                            <label class="layui-form-label">字段名</label>                            <div class="layui-input-inline">                                <input type="text" v-model="item.columnName" :name="['LayuiForm['+(n)+'].columnName']" readonly    class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">字段注释</label>                            <div class="layui-input-inline">                                <input type="text" v-model="item.columnComment" :name="['LayuiForm['+(n)+'].columnComment']"    class="layui-input">                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">表单类型</label>                            <div class="layui-input-block" style="width: 140px;">                                <select :class="['layselect'+(n)]" :name="['LayuiForm['+(n)+'].type']"  lay-filter="type" lay-search >                                    <option value="input">输入框</option>                                    <option value="date">时间</option>                                    <option value="radio">单选框</option>                                    <option value="checkbox">多选框</option>                                    <option value="select">下拉菜单</option>                                    <option value="textarea">多行文本框</option>                                    <option value="upload">图片上传</option>                                </select>                            </div>                        </div>                        <div class="layui-inline " v-show="item.expand=='checkbox'">                            <label class="layui-form-label" lay-tips="value为传入数据库的值，title为页面展示字段，数组的个数即为checkbox的个数。">多选数据</label>                            <div class="layui-input-block">                                <input type="text" :name="['LayuiForm['+(n)+'].checkboxJson']" value='[{value:"1",title:"1"},{value:"2",title:"2"},{value:"3",title:"3"}]' class="layui-input">                            </div>                        </div>                        <div class="layui-inline" v-show="item.expand=='select'">                            <label class="layui-form-label">数据字典</label>                            <div class="layui-input-block">                                <select  :name="['LayuiForm['+(n)+'].dic']"  lay-filter="dic" lay-search  >                                    <option></option>                                    <option v-for="dic in dics" :value="dic.dictTypeId">{{dic.name}}</option>                                </select>                            </div>                        </div>                        <div class="layui-inline">                            <label class="layui-form-label">表单验证</label>                            <div class="layui-inline" :class="['laycheck'+(n)]">                                <input type="checkbox" :class="['check'+(n)]"  lay-type="required" lay-filter="verify" title="非空" lay-skin="primary">                                <input type="checkbox" :class="['check'+(n)]"  lay-type="phone" lay-filter="verify" title="手机号" lay-skin="primary">                                <input type="checkbox" :class="['check'+(n)]"  lay-type="identity" lay-filter="verify" title="身份证号" lay-skin="primary">                                <input class="layui-hide"  :id="['layformcheck'+(n)]" :name="['LayuiForm['+(n)+'].verify']" >                                <input type="checkbox" checked="" :name="['LayuiForm['+(n)+'].hidden']"  lay-skin="switch" lay-filter="switchTest" lay-text="显示|隐藏">                            </div>                        </div>                    </td>                </tr>            </template>        </table>        <div class="layui-form-item text-center" style="margin-top: 30px;">            <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog">取消</button>            <button class="layui-btn" lay-submit lay-filter="form" id="submit">保存</button>        </div>    </form></div><script>    var form = layui.form;    var $ = layui.$;    form.render();    var vm = new Vue({        el:'#app',        data:{            msg:'Hello World!',            items:[],            dics:[]        },        mounted:async function() {            vm = this;            vm.items = await request.fetch("/admin/gen/getTableFields",{tableName:'${parameter.tableName}'})            vm.dics = await api.getDicTypeList();            form.on('select(type)', function(data){                var className = data.elem.className;                var num = parseInt(className.substring(9))                if(data.value){                    Vue.set(vm.items[num],"expand",data.value);                }else{                    Vue.set(vm.items[num],"expand",data.value);                }            });            form.on('submit(form)', function(data){                var columnNames = "";                for (var tableItem in fields) {                    columnNames +=  fields[tableItem]+",";                }                data.field.tableName = $("#tableName").val();                if(columnNames.length>0){                    data.field.searchFields = columnNames.slice(0,columnNames.length-1);                    request.post("/admin/gen/setConditionFields",data.field).then(res=>{                        admin.closeThisDialog();                    });                }else{                    alert("请选择需要查询的字段");                    return false;                }                return false;            });        },        updated: function () {            form.render()        },        watch:{            items:function (val,oldVal) {            }        },        methods:{            getItem:function () {            },            getDic:function (){            },            updated:function () {                form.render()            }        }    });    var fields = new Array();    form.on('checkbox(search)', function(data){        if(data.elem.checked){            fields.push(data.value)        }else{            //找到数据在数组中的下标            var index = fields.indexOf(data.value);            fields.splice(index, 1);        }    });    form.on('checkbox(verify)', function(data){        var className = data.elem.className;        var arr = [];        $('.lay'+className).find("input[type=checkbox]:checked").each(function(){            arr.push($(this).attr("lay-type"))        })        var value=arr.join("|");        $('#layform'+className).val(value);    });</script><% } %>