<%layout("/common/_container.html"){%><div class="layui-fluid" id="app">    <div class="layui-row layui-col-space15">        <div class="layui-col-sm12 layui-col-md3 layui-col-lg2">            <div class="layui-card">                <div class="layui-card-body mini-bar">                    <div id="lay-tree" style="font-size: 15px;margin-top: 20px;"></div>                </div>            </div>        </div>        <div class="layui-col-sm12 layui-col-md9 layui-col-lg10">            <div class="layui-card">                <div class="layui-card-body">                    <table class="layui-table" id="deptTable" lay-filter="deptTable"></table>                </div>            </div>        </div>    </div>    </div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></script><script>    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            clicked:0,            tree:'',            deptTable:''        },        methods: {        },        mounted:async function() {            vm = this;            vm.tree = await api.getDeptTree();            var treeOption = {                elem: '#lay-tree'  //绑定元素                ,id: 'demoTree' //定义索引                ,data: vm.tree                ,edit: ['add', 'update','del']                ,accordion: true                ,click: function(obj){                    var elem = obj.elem; //得到当前节点元素                    $('#lay-tree').find('.layui-tree-txt').removeClass('treeClick');                    $(elem).find('.layui-tree-txt').eq(0).addClass('treeClick');                    vm.clicked = obj.data.id                    table.reload('deptTable', {where: {                            deptId:vm.clicked                        }});                }                ,operate: function(obj){                    var type = obj.type; //得到操作类型：add、edit、del                    var data = obj.data; //得到当前节点的数据                    var elem = obj.elem; //得到当前节点元素                    //Ajax 操作                    var id = data.id; //得到节点索引                    if(type === 'add'){ //增加节点                       var key;                       request.$postData('/admin/dept/addDeptNode',{deptId:id},function (res) {                           key = res.deptId;                       })                       var action = $(elem).find(".layui-tree-icon").find('.layui-icon').attr("class").split(/\s+/)[1];                       if(action=='layui-icon-addition'){                           $(elem).find(".layui-tree-icon").next().click();                       }                       return key;                    } else if(type === 'update'){ //修改节点                        var text = elem.find('.layui-tree-txt').html();                        data.text = text;                        api.editDept({deptId:data.id,deptName:data.text}).then(res=>{                            $(elem).find(".layui-tree-txt").click();                        });                    }else if(type === 'del'){ //修改节点                        api.delDept(data.id).then(res=>{                            app.success("删除成功")                            location.reload()                        }).catch(res=>{                            location.reload()                        });                    }                }            }            var laytree = tree.render(treeOption);            var  initColumn =  [[                    {type: 'checkbox'},                    {field: 'deptId', hide: true, title: 'ID'},                    {field: 'deptName',title: '部门名称'},                    {field: 'orderNum',title: '排序'},                    {field: 'createTime',title: '创建时间'},                    {field: 'modifyTime',title: '修改时间'},                    {align: 'center', toolbar: '#tableBar', title: '操作'}            ]];            table.render({                elem: '#deptTable',                url: '/admin/dept/getDeptList',                page: true,                height: "full-50",                cellMinWidth: 100,                cols: initColumn,                where: {deptId: vm.clicked},                parseData:function (data) {                    app.handleExceptions(data);                }            });            table.on('tool(deptTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    api.delDept(data.deptId).then(res=>{                        app.success("删除成功");                        location.reload();                    }).catch(res=>{                        location.reload()                    });                } else if (event == 'edit') {                    admin.putTempData('formOk', false);                    top.layui.admin.open({                        type: 2,                        title: '修改',                        content: '/admin/dept/dept_edit?deptId='+data.deptId,                        resize:true,                        end:function () {                            admin.getTempData('formOk') && location.reload();                        }                    });                }            });            //默认第一个机构选中状态            $('.layui-tree').find('.layui-tree-txt').eq(0).addClass('treeClick');            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>