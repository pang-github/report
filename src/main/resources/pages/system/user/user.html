<%layout("/common/_container.html"){%><div class="layui-fluid" id="app">    <div class="layui-row layui-col-space15">        <div class="layui-col-sm12 layui-col-md3 layui-col-lg2">            <div class="layui-card">                <div class="layui-card-body mini-bar">                    <div id="lay-tree" style="font-size: 15px;margin-top: 20px;"></div>                </div>            </div>        </div>        <div class="layui-col-sm12 layui-col-md9 layui-col-lg10">            <div class="layui-card">                <div class="layui-card-body">                      <div class="layui-form toolbar">                          <div class="layui-form-item">                              <div class="layui-inline">                                  <input  v-model="condition" class="layui-input" type="text" placeholder="名称"/>                              </div>                              <div class="layui-inline">                                  <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                                  <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                                  <button type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                              </div>                          </div>                      </div>                    <table class="layui-table" id="userTable" lay-filter="userTable"></table>                </div>            </div>        </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="reset">重置密码</a>    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></script><!-- 表格状态列 --><script type="text/html" id="tableStateUser">    <input type="checkbox" lay-filter="ckStateUser" value="{{d.userId}}" data-name = "{{d.userName}}" lay-skin="switch"           lay-text="正常|锁定" {{d.accountStatus=='1'?'checked':''}}/></script><script>    var  initColumn =  [[        {type: 'checkbox'},        {field: 'userId', hide: true, title: 'USERID'},        {field: 'userName',title: '用户名'},        {field: 'birthday',title: '出生日期'},        {field: 'deptName',title: '机构名称'},        {field: 'accountStatus',title: '账号状态', templet: '#tableStateUser'},        {align: 'center', toolbar: '#tableBar', title: '操作'}    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            deptId:'',            tree:'',            condition:''        },        methods: {            btnAdd:function () {                admin.putTempData('formOk', false);                top.layui.admin.open({                    type: 2,                    title: '添加用户',                    content: '${domain}/admin/user/user_edit?deptId='+vm.deptId,                    end:function () {                        admin.getTempData('formOk') && vm.tableReload();                    }                });            },            tableReload:function (action) {                if(action=='reset'){ vm.condition = '' };                table.reload('userTable', {where: {                        deptId:vm.deptId,                        userName:vm.condition                    },page:{ curr:1 }});            }        },        mounted:async function() {            vm = this;            vm.tree = (await api.getDeptTree())[0].children;            if(vm.tree.length>1){                vm.deptId = vm.tree[0].id;            }else{                vm.deptId = vm.tree.id;            }            //左侧树形            var treeOption = {                elem: '#lay-tree'  //绑定元素                ,id: 'demoTree' //定义索引                ,data: vm.tree                ,click: function(obj){                    var elem = obj.elem; //得到当前节点元素                    $('#lay-tree').find('.layui-tree-txt').removeClass('treeClick');                    $(elem).find('.layui-tree-txt').eq(0).addClass('treeClick');                    vm.deptId = obj.data.id                    vm.tableReload();                }            }            var laytree = tree.render(treeOption);            //默认点击第一个机构            $('.layui-tree').find('.layui-tree-txt').eq(0).addClass('treeClick');            table.render({                elem: '#userTable',                url: '${domain}/admin/user/getUserList',                page: true,                height: "full-105",                cellMinWidth: 100,                cols: initColumn,                where: {deptId: vm.deptId}            });            table.on('tool(userTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    app.confirm("确定删除吗?",function () {                        api.delUser(data).then(res=>{                            app.success("删除成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    admin.putTempData('formOk', false);                    top.layui.admin.open({                        type: 2,                        title: '修改',                        content: '${domain}/admin/user/user_edit?userId='+data.userId,                        end:function () {                            admin.getTempData('formOk') && vm.tableReload();                        }                    });                } else if (event == 'reset') {                    app.confirm("确定要重置该用户的密码吗？",function () {                        api.resetPassword(data).then(res=>{                            app.success("操作成功！");                        });                    })                }            });            // 修改用户状态            form.on('switch(ckStateUser)', function (obj) {                var name = $(obj.elem).data("name")                api.editUser({userId:obj.elem.value,accountStatus:obj.elem.checked ? 1 : 0,userName:name}).then().catch(err=>{                    location.reload();                });            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>