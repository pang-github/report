<% layout("/common/_container.html"){ %><div class="layui-fluid" id="app" >    <div class="layui-row layui-col-space15">    <div class="layui-col-md5">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                    <div class="layui-form-item">                        <div class="layui-inline">                            <input v-model="condition" class="layui-input" type="text" placeholder="名称"/>                        </div>                        <div class="layui-inline">                            <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                            <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            <button type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                        </div>                    </div>                </div>                <table class="layui-table" id="templateTable" lay-filter="templateTable"></table>            </div>        </div>    </div>    <div class="layui-col-md7" >        <div class="layui-card">            <div class="layui-card-body" style="height: calc(100vh - 65px); overflow: scroll" >                <div v-if="data">                <div style="margin-left: 80%">                 <button type="button" @click="addtpl" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                 <button type="button" @click="savetpl" class="layui-btn icon-btn"><i class="layui-icon">&#xe605;</i>保存</button>                </div>                <form class="layui-form">                <table class="layui-table" >                    <colgroup>                        <col width="20%">                        <col width="20%">                        <col width="20%">                        <col>                        <col width="10%">                    </colgroup>                    <thead>                    <tr>                        <th>序号</th>                        <th>随访项目</th>                        <th>随访形式</th>                        <th>示例</th>                        <th>操作</th>                    </tr>                    </thead>                    <tbody>                    <template v-for="(item,index) in tplList">                        <tr>                            <td>{{index+1}}</td>                            <td><input class="layui-input" type="text" v-model="item.title"/></td>                            <td>                                <select lay-filter="project" :data-index="index">                                    <option></option>                                    <option v-for="select in option" :value="select.value" :selected="item.type==select.value">{{select.title}}</option>                                </select>                            </td>                            <td>                                <input class="layui-input" type="text" v-if="item.type==1"/>                                <template v-if="item.type==2">                                    <input type="radio" name="project"  :value="radio.option" :title="radio.option"  v-for="radio in item.option">                                </template>                                <template v-if="item.type==3">                                    <input type="checkbox" name="like" lay-skin="primary" :title="chebox.option" v-for="chebox in item.option">                                </template>                                <template v-if="item.type==4">                                    <select :data-index="index">                                        <option></option>                                        <option v-for="select in item.option">{{select}}</option>                                    </select>                                </template>                                <template v-if="item.type==5">                                    <textarea class="layui-textarea"></textarea>                                </template>                            </td>                            <td>                                <button v-if="index==(tplList.length-1)"  type="button" @click="del($event,index)" class="layui-btn layui-btn-primary icon-btn layui-btn-sm" ><i class="layui-icon">&#xe640;</i>删除</button>                            </td>                        </tr>                    </template>                    </tbody>                </table>                </form>            </div>        </div>        </div>    </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></script><script>    var initColumn =  [[        {type: 'radio'},        {field:'tplId',title:'模板id',hide:true},        {field:'title',title:'模板标题'},        {field:'content',title:'模板内容',hide:true},        {field:'createId',title:'创建人',hide:true},        {field:'createTime',title:'创建时间'},        {align: 'center', toolbar: '#tableBar', title: '操作'}    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            condition:'',            option:[{value:1,title:'输入框'},{value:2,title:'单选框'},{value:3,title:'多选框'},{value:4,title:'下拉框'},{value:5,title:'多行输入框'}],            data:'',            tplList:[],        },        methods: {            btnAdd:function () {                location.href = 'template_edit';            },            tableReload:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    title:vm.condition,                };                table.reload('templateTable',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                    }});            },            addtpl:function () {                vm.tplList.push({title:'',option:'',type:''});            },            savetpl:function () {                vm.data.content = JSON.stringify(vm.tplList);                request.post("/admin/template/editTemplate",vm.data).then(res=>{                     app.success("操作成功！")                })            },            del:function (e,index) {               // $(e.target).parents('tr').remove();               vm.tplList.splice(index,1);            }        },        mounted:async function() {            vm = this;            table.render({                elem: '#templateTable',                url: 'getTemplateList',                page: true,                height: "full-105",                cellMinWidth: 100,                cols: initColumn            });            table.on('row(templateTable)', function (obj) {                vm.data = obj.data;                if(vm.data.content){                    vm.tplList = JSON.parse(vm.data.content)                }            });            table.on('tool(templateTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    app.confirm("确定删除吗?",function () {                        request.fetch("delTemplate",{tplId:data.tplId}).then(res=>{                            app.success("删除成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    location.href = 'template_edit?tplId='+data.tplId;                }            });            form.on('select(project)', function(data){                var dataindex = data.elem.dataset.index;                var type = data.value;                vm.tplList[dataindex].type = type;                if(type==1){return}                if(type==5){return}                //例子2                layer.prompt({                    formType: 2,                    value: '',                    title: '请输入选项 多个用，隔开',                    area: ['800px', '350px'] //自定义文本域宽高                }, function(value, index, elem){                    value = value.replace(/，/g,",")                    var options = value.split(",");                    var option;                    if(type==4){                        option = options;                    }else{                           option = new Array();                        for(let i of options){                            console.log(i);                            var item = {                                option:i,                                ischecked:false                            }                            option.push(item);                        }                    }                    vm.tplList[dataindex].option=option;                    layer.close(index);                });            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>