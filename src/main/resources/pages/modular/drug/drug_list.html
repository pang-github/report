<% layout("/common/_container.html"){ %><div class="layui-fluid" id="app">    <div class="layui-col-md12">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                    <div class="layui-form-item">                        <div class="layui-inline">                            <input v-model="condition" class="layui-input" type="text" placeholder="名称"/>                        </div>                        <div class="layui-inline">                            <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                            <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            <button type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                        </div>                        <!--<div class="layui-inline">                            <input id="drugPrice" value="${drugPrice}" oninput="app.clearNoNum(this)" class="layui-input" type="number" placeholder="价格增加比例(如:15)"/>                        </div>                        <div class="layui-inline">                            <button id="btnUp" @click="btnUp" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>确定增加</button>                        </div>-->                    </div>                </div>                <table class="layui-table" id="drugTable" lay-filter="drugTable"></table>            </div>        </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></script><script>    var initColumn =  [[        {type: 'checkbox'},        {field:'id',title:'',hide:true},        {field:'drugNum',title:'药品编号'},        {field:'drugName',title:'药品名称'},        {field:'drugUnit',title:'药品单位'},        {field:'manufacturer',title:'生产厂商'},        {field:'drugPrice',title:'药品价格'},        {field:'upprice',title:'加价后价格'},        {field:'drugExplain',title:'药品说明'},        {align: 'center', toolbar: '#tableBar', title: '操作'}    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            condition:'',            ids:"",        },        methods: {            btnAdd:function () {                location.href = 'drug_edit';            },            btnUp:function(){                var checkStatus = table.checkStatus('drugTable');                var a = checkStatus.data;                var json = JSON.stringify(a)                if(app.isNotEmpty(vm.ids.length)){                    var num = $("#drugPrice").val();                    request.post("/admin/drug/drugPrice",{drugPrice:num,ids:vm.ids}).then(res=>{                        app.success("操作成功！");                        location.href = 'drug_list'                    })                }else{                    app.error("请选择一条数据")                }            },            tableReload:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    drugNum:vm.condition,                    drugName:vm.condition,                    id:vm.condition,                };                table.reload('drugTable',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                    }});            }        },        mounted:async function() {            vm = this;            var p = app.getUrlParam('page');            table.render({                elem: '#drugTable',                url: 'getDrugList',                page:{                    curr: p //重新从第 1 页开始                },                height: "full-105",                cellMinWidth: 100,                cols: initColumn,            });            table.reload('drugTable',{                page: {                    curr: p //重新从第 1 页开始                }});            table.on('checkbox(drugTable)', function(data){                var  a = data.data;                vm.ids += a.id+",";                form.render('checkbox');            });            table.on('tool(drugTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    app.confirm("确定删除吗?",function () {                        request.fetch("delDrug",data).then(res=>{                            app.success("删除成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    var s = $(".layui-laypage-em").next().html()                    location.href = 'drug_edit?id='+data.id+"&page="+s;                }            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>