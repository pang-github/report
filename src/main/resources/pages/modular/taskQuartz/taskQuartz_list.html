<% layout("/common/_container.html"){ %><div class="layui-fluid" id="app">    <div class="layui-col-md12">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                    <div class="layui-form-item">                        <div class="layui-inline">                            <input v-model="condition" class="layui-input" type="text" placeholder="名称"/>                        </div>                        <div class="layui-inline">                            <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                            <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            <button type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                        </div>                    </div>                </div>                <table class="layui-table" id="taskQuartzTable" lay-filter="taskQuartzTable"></table>            </div>        </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-xs" lay-event="start">启动</a>    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    {{#  if(d.jobStatus =='1'){ }}        <a class="layui-btn  layui-btn-warm layui-btn-xs" lay-event="pause">暂停</a>    {{#  } }}    {{#  if(d.jobStatus =='2'){ }}        <a class="layui-btn  layui-btn-warm layui-btn-xs" lay-event="pause">继续</a>    {{#  } }}    <a class="layui-btn layui-btn-xs" lay-event="detail">随访详情</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">移除</a></script><script>    var initColumn =  [[        {type: 'checkbox'},        {field:'id',title:'',hide:true},        {field:'jobGroup',title:'任务分组'},        {field:'jobName',title:'任务名'},        {field:'description',title:'任务描述'},        {field:'cronExpression',title:'cron表达式'},        {field:'jobClassName',title:'包类名'},        {field:'jobStatus',title:'任务状态',templet(d){            if(d.jobStatus=='1'){                return '运行中'            }else if(d.jobStatus=='2'){                return '暂停中'            }else if(d.jobStatus=='3'){                return '未执行'            }            }},        {field:'createTime',title:'创建时间'},        {align: 'center', toolbar: '#tableBar', title: '操作',width:300}    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            condition:''        },        methods: {            btnAdd:function () {                location.href = 'taskQuartz_edit';            },            tableReload:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    id:vm.condition,                };                table.reload('taskQuartzTable',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                    }});            }        },        mounted:async function() {            vm = this;            table.render({                elem: '#taskQuartzTable',                url: 'getTaskQuartzList',                page: true,                height: "full-105",                cellMinWidth: 100,                cols: initColumn            });            table.on('tool(taskQuartzTable)', function (obj) {                var event = obj.event;                var data = obj.data;                console.log(obj);                if (event == 'del') {                    app.confirm("确定移除任务吗?",function () {                        request.fetch("remove",{id:data.id}).then(res=>{                            app.success("移除成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    location.href = 'taskQuartz_edit?id='+data.id;                } else if (event == 'start') {                    request.fetch("/admin/taskQuartz/start",{id:data.id}).then(res=>{                        app.success("操作成功！")                        vm.tableReload();                    })                } else if (event == 'pause') {                    request.fetch("/admin/taskQuartz/pause",{id:data.id}).then(res=>{                        app.success("操作成功！")                        //同步更新缓存对应的值                        vm.tableReload();                    })                } else if (event == 'detail') {                   window.location.href = '/admin/taskdetail/taskdetail_list?taskId='+data.id                }            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>