package com.sweet.modular.medicine;import cn.hutool.core.date.DateUtil;import com.alibaba.fastjson.JSON;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.sweet.core.model.ResultBean;import com.sweet.core.model.system.HelloPacket;import com.sweet.core.model.system.LayuiPageInfo;import com.sweet.core.translationDict.DictParam;import com.sweet.core.translationDict.TranslationDict;import com.sweet.core.util.RedisUtil;import com.sweet.core.util.StringUtil;import com.sweet.modular.patient.entity.Patient;import com.sweet.modular.patient.service.PatientService;import com.sweet.modular.record.entity.Record;import com.sweet.modular.record.service.RecordService;import com.sweet.modular.rxdrug.entity.Rxdrug;import com.sweet.modular.rxdrug.service.RxdrugService;import com.sweet.modular.weixin.service.WeiXinService;import com.sweet.system.entity.User;import com.sweet.system.service.UserService;import org.rockyang.tio.websocket.starter.TioWebSocketServerBootstrap;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import me.chanjar.weixin.common.error.WxErrorException;import me.chanjar.weixin.mp.bean.template.WxMpTemplateData;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Controller;import org.springframework.transaction.annotation.Transactional;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.tio.core.Tio;import org.tio.websocket.common.WsResponse;import javax.servlet.http.HttpServletRequest;import javax.xml.transform.Result;import java.util.ArrayList;import java.util.Date;import java.util.List;/** * <p> * 患者住院档案 前端控制器 * </p> * * @author admin * @since 2020-01-08 */@Controller@RequestMapping("/admin/medicine")public class MedicineController {    static Logger logger = LoggerFactory.getLogger(MedicineController.class);    @Autowired    private TioWebSocketServerBootstrap bootstrap;    @Autowired    HttpServletRequest request;    @Autowired    UserService userService;    @Autowired    RecordService recordService;    @Autowired    RedisUtil redisUtil;    @Autowired    RxdrugService rxdrugService;    @Autowired    WeiXinService weiXinService;    @Autowired    PatientService patientService;    @Value("${system.domain}")    public String domain;    /**     * 列表页     */    @RequestMapping("/drug")    public String list() {        return "/modular/medicine/drug";    }    /**     * 打印页     */    @RequestMapping("/medicine_print")    public String print() {        return "/modular/medicine/medicine_print";    }    /**     * 医生页面     */    @RequestMapping("/doctor")    public String edit() {        return "/modular/medicine/doctor";    }    /**     * 药剂师页面     */    @RequestMapping("/pharmacy")    public String pharmacy() {        return "/modular/medicine/pharmacy";    }    /**     * tio页面     */    @RequestMapping("/tioDemo")    public String tioDemo() {        return "/modular/medicine/tioDemo";    }    /**     * 推送消息到客户端     * @throws Exception     */    @GetMapping("/push")    @ResponseBody    public String pushMessage(String message)    {        message = "服务端主动推送的消息: " + message;        Tio.sendToAll(bootstrap.getServerGroupContext(), WsResponse.fromText(message,"utf-8"));        logger.info("Push a message to client successfully");        return "Push a message to client successfully";    }}