package com.sweet.modular.patient.controller;import com.sweet.core.exception.ServiceException;import com.sweet.core.translationDict.DictParam;import com.sweet.core.translationDict.TranslationDict;import com.sweet.core.util.HanyupinyinUtil;import com.sweet.core.util.RedisUtil;import com.sweet.system.entity.User;import com.sweet.system.service.UserService;import org.apache.commons.lang3.StringUtils;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import com.sweet.core.model.ResultBean;import com.sweet.core.model.system.LayuiPageInfo;import com.sweet.modular.patient.entity.Patient;import com.sweet.modular.patient.service.PatientService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.RequestMapping;import com.sweet.core.util.StringUtil;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.stereotype.Controller;/** * <p> * 患者表 前端控制器 * </p> * * @author admin * @since 2020-01-07 */@Controller@RequestMapping("/admin/patient")public class PatientController {    @Autowired    private PatientService patientService;    @Autowired    private UserService userService;    /**     * 列表页     */    @RequestMapping("/patient_list")    public String list(){        return "/modular/patient/patient_list";    }    @RequestMapping("/step")    public String step(){        return "/modular/patient/step";    }    @RequestMapping("/step_add")    public String stepadd(){        return "/modular/patient/step_add";    }    @RequestMapping("/step_record")    public String steprecord(){        return "/modular/patient/step_record";    }    @RequestMapping("/step_print")    public String steprint(){        return "/modular/patient/step_print";    }    @RequestMapping("/followResult")    public String followResult(){        return "/modular/patient/followResult";    }    /**     * 编辑页     */    @RequestMapping("/patient_edit")    public String edit(Model model){        return "/modular/patient/patient_edit";    }    /**     * 添加/编辑     */    @RequestMapping("/editPatient")    @ResponseBody    public ResultBean editPatient(Patient patient){        if (StringUtils.isEmpty(patient.getId())){            User user = new User();            //String name =  HanyupinyinUtil.getPinyinString(patient.getPatientName());            String phonenumber = patient.getPhoneNumber();            User temp = userService.findByUserName(phonenumber);            if(StringUtil.isEmpty(phonenumber)){                temp=null;                phonenumber = patient.getPatientName();            }            if((temp!=null)){                throw new ServiceException("该手机号已被占用！");            }else{                user.setUserName(phonenumber);                user.setAccountStatus(0);//设置用户状态冻结                user.setUserType(0);//区分用户不被查询                userService.addUser(user);            }            patient.setUserid(user.getUserId());            patient.setPatientSource("0");//后台注册        }        patientService.saveOrUpdate(patient);        return ResultBean.success(patient);    }    /**     * 删除     */    @RequestMapping("/delPatient")    @ResponseBody    public ResultBean delPatient(Patient patient){        patientService.removeById(patient);        return ResultBean.success(patient);    }    /**     * 添加修改菜单     * @param menu     * @return     */    @RequestMapping("/getPatientDetail")    @ResponseBody    public ResultBean getPatientDetail(String id){        Patient patient = patientService.getById(id);        return ResultBean.success(patient);    }    /**     * 列表数据     */    @RequestMapping("/getPatientList")    @ResponseBody    @TranslationDict({            @DictParam(dictType = "92395206b9178d57bdaded66674b888c",dictValueFiled = "patientNation"),            @DictParam(dictType = "9697b6e46ab6995bb11c30f60f6dca77",dictValueFiled = "marriage"),            @DictParam(dictType = "9ae86115b7f4d79b2d8dfa5a381c6bdc",dictValueFiled = "patientType"),    })    public LayuiPageInfo getPatientList(Patient Patient){        LayuiPageInfo pageInfo = patientService.findPageBySpec(Patient);        return pageInfo;    }}