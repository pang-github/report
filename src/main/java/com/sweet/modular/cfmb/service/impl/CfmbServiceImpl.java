package com.sweet.modular.cfmb.service.impl;import com.sweet.core.util.BigDecimalUtil;import com.sweet.core.util.StringUtil;import com.sweet.modular.cfmb.entity.Cfmb;import com.sweet.modular.cfmb.mapper.CfmbMapper;import com.sweet.modular.cfmb.service.CfmbService;import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;import com.sweet.modular.cfnr.entity.Cfnr;import com.sweet.modular.cfnr.service.CfnrService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import com.baomidou.mybatisplus.core.metadata.IPage;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.sweet.core.model.system.LayuiPageFactory;import com.sweet.core.model.system.LayuiPageInfo;import javax.servlet.http.HttpServletRequest;import java.math.BigDecimal;/** * <p> * 处方模板 服务实现类 * </p> * * @author admin * @since 2020-01-08 */@Servicepublic class CfmbServiceImpl extends ServiceImpl<CfmbMapper, Cfmb> implements CfmbService {    @Autowired    CfnrService cfnrService;    @Override    public LayuiPageInfo findPageBySpec(Cfmb cfmb) {        Page pageContext = LayuiPageFactory.defaultPage();        IPage page = this.baseMapper.customPageList(pageContext, cfmb);        return LayuiPageFactory.createPageInfo(page);    }    @Override    public void add(Cfmb cfmb, HttpServletRequest request) {        cfmb.setId(StringUtil.getUUID());        String drugName[] = (request.getParameter("drugNamepro")).split(",");        String drugMass[] = (request.getParameter("drugMasspro")).split(",");        String drugUnit[] = (request.getParameter("drugUnitpro")).split(",");        String drugPrice[] = (request.getParameter("drugPricepro")).split(",");        Double allmoney = 0.0;        for (int i = 0;i<drugName.length;i++){            Cfnr cfnr = new Cfnr();            cfnr.setRecipeId(cfmb.getId());            cfnr.setDrugName(drugName[i]);            cfnr.setDrugUnit(drugUnit[i]);            cfnr.setDrugMass(drugMass[i]);            cfnr.setDrugPrice( new BigDecimal(drugPrice[i]));            cfnrService.save(cfnr);            allmoney += BigDecimalUtil.mul(drugMass[i],drugPrice[i]);        }        cfmb.setRecipePrice(new BigDecimal(allmoney));        this.save(cfmb);    }}